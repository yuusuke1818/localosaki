<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j">
<head jsfc="h:head">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<h:outputStylesheet library="css" name="common/default.css" />
<h:outputStylesheet library="css" name="common/cssLayout.css" />
<h:outputStylesheet library="css" name="common/button.css" />
<h:outputStylesheet library="css" name="common/common.css" />
<h:outputStylesheet library="css" name="common/jsframe.css" />
<h:outputScript library="js" name="common/jquery-1.12.3.min.js" />
<h:outputScript library="js" name="common/separater.js" />
<h:outputScript library="js" name="common/common.js" />
<h:outputScript library="js" name="common/searchCommon.js" target="body" />
<h:outputScript library="js" name="common/jsframe.js" />
<title>#{loginBean.getApplicationName()}&nbsp;#{loginBean.getOemName()}&nbsp;ver&nbsp;#{loginBean.getApplicationVersion()}-#{loginBean.getOemVersion()}&nbsp;#{loginBean.getProjectStage()}</title>
<c:if test="#{loginBean.faviconBool}">           
    <link rel="shortcut icon" href="#{request.contextPath}/resources/images/ico/favicon_24x24.png" type="image/x-icon" />
</c:if>
</head>
<body jsfc="h:body">
    <script>
            //操作中の企業名が文字数に合わせてフォントサイズを調整する
            $(function () {
                //操作中企業の文字数
                var companyStrLength = #{loginBean.getLoginOperationCorpName().length()};
                //34文字以上の場合2段表示するためにmargin-topを調整する
                if (companyStrLength > 33) {
                    $(".target_company, .top_page_target_company").css({'font-size': '16px', 'margin-top': '-7px'});
                } else if (companyStrLength > 29) {
                    $(".target_company, .top_page_target_company").css({'font-size': '16px'});
                } else if (companyStrLength > 26) {
                    $(".target_company, .top_page_target_company").css({'font-size': '18px'});
                } else if (companyStrLength > 22) {
                    $(".target_company, .top_page_target_company").css({'font-size': '20px'});
                }
            });
        </script>
    <div id="block-modal-content">
        <h:graphicImage library="images" name="loading.gif" />
    </div>
    <form jsfc="h:form" id="templateform">
        <div id="back_left"></div>
        <div id="back_center"></div>
        <div id="back_right"></div>
        <div id="top">
            <div id="header_wrap">
                <div id="left_header">
                    <h:panelGrid columns="2">
                        <c:if test="#{loginBean.menuLogoBool}">
                            <h:graphicImage
                                value="#{loginBean.getConvertImageDataBase64(loginBean.loginCorpLogo)}"
                                style="width: 120px; height: 40px;" />
                        </c:if>
                        <h:graphicImage style="width:300px; height:40px;" library="images" name="sms_logo_other.png" />
                    </h:panelGrid>
                </div>
                <div id="right_header">
                    <div id="other">
                        <h:panelGrid columns="4">
                            <c:if test="#{loginBean.termsOfServiceBool}">
                                <h:commandLink value="利用規約"
                                    action="#{loginBean.termsOfService()}" target="_blank" />
                            </c:if>
                            <c:if test="#{indexBean.userGuideBool}">
                                <h:commandLink value="ユーザーズガイド"
                                    action="#{indexBean.userGuide()}" target="_blank" />
                            </c:if>
                            <c:if test="#{loginBean.inquryBool}">
                                <h:outputLink value="#{indexBean.inqury}" target="_blank">お問い合わせ</h:outputLink>
                            </c:if>

                            <h:commandButton value="ログアウト" id="logoutButton"
                                onclick="if (actionChangeCheck !== undefined) {
                                                             return actionChangeCheck($('input[id$=logoutButton]'));
                                                         }"
                                action="#{loginBean.logout()}" />
                        </h:panelGrid>
                    </div>
                    <div id="user_name_area">
                        <div class="user_name_contents contents_vertical_centering">
                            <div
                                class="user_name contents_vertical_centering contents_horisontal_centering">
                                <span style="font-size: 12px; width: 110px">ログインユーザー</span> <span>&nbsp;&nbsp;#{loginBean.getLoginPersonName()}</span>
                            </div>
                            <div class="api_key_icon contents_vertical_centering">
                                <ui:fragment rendered="#{loginBean.getApiKeyVisble()}">
                                    <h:commandLink id="apiKeyButton" value="">
                                        <a4j:ajax event="click"
                                                  render="apikeyDialogContents"
                                                  listener="#{loginBean.showApiKeyDialog()}"
                                                  oncomplete="#{rich:component('apikeyDialog')}.show();" />
                                        <h:graphicImage class="apikey_button" library="images" name="common/apikey.png" />
                                    </h:commandLink>
                                </ui:fragment>
                            </div>
                        </div>
                    </div>
                    <!--                    パスワード有効期限切れまであと30日です。
                                            <span id="sessionCountDiv">タイムアウトまであと<span id="sessionCount">30</span>分</span>-->
                </div>
            </div>
        </div>
        <div id="navi_area"></div>
        <!-- お知らせポップアップ表示用ボタン -->
        <a4j:commandButton style="display: none;" id="showOshiraseButton"
            value="お知らせ確認" actionListener="#{indexBean.checkOshirase()}"
            render=":checkOshirasePopupForm"
            oncomplete="
                               if (#{indexBean.isFirstAccess()}) {
                               #{rich:component('checkOshirasePopupWindow')}.show();
                               }" />
        <!-- お知らせポップアップ表示キャンセルボタン -->
        <a4j:commandButton style="display: none;"
            id="canselShowOshiraseButton" value="お知らせキャンセル"
            actionListener="#{indexBean.setShowOshiraseSessionFlg(false)}" />
    </form>
    <div id="content">
        <ui:insert name="content">Content</ui:insert>
    </div>
    <div id="bottom">
        <div id="footer_logo_area">
            <!--
                <h:graphicImage id="footer_logo_main" library="images" name="common/com027.png" />
                -->
        </div>
        <div id="copyright_area">#{loginBean.copyright}</div>
    </div>
    <script type="text/javascript">
            var keyBlock = false;
            function startPolling() {
                $('span[id$=queryEnd]')[0].innerText = 'start';
                showBlockModal();
                setTimeout(doCheck, 1000);
            }
            function doCheck() {
                $('input[id$=checkQueryButton]').click();
            }
            function errorEndPolling() {
                hideBlockModal();
            }
            function endPolling() {
                var val = $('span[id$=queryEnd]')[0].innerText;
                if (val === 'true') {
                    $('input[id$=getResultButton]').click();
                } else {
                    setTimeout(doCheck, 1000);
                }
            }
            function showBlockModal() {
                if ($("#block-modal-overlay")[0])
                    return false;
                //オーバーレイ用のHTMLコードを、[body]内の最後に生成する
                $("body").append('<div id="block-modal-overlay"></div>');
                $("#block-modal-overlay").show();
                $("#block-modal-content").show();
                var w = $(window).width();
                var h = $(window).height();
                var cw = $("#block-modal-content").width();
                var ch = $("#block-modal-content").height();
                var pxleft = ((w - cw) / 2);
                var pxtop = ((h - ch) / 2);
                $("#block-modal-content").css({"left": pxleft + "px"});
                $("#block-modal-content").css({"top": pxtop + "px"});
                keyBlock = true;
                return true;
            }
            function hideBlockModal(nonScrollFlg) {
                $("#block-modal-overlay").hide(0, function () {
                    $("#block-modal-overlay").remove();
                });
                $("#block-modal-content").hide();
                keyBlock = false;
                if (!nonScrollFlg) {
                    window.scrollTo(0, 0);
                }
            }
            function actionIntervalBlock() {
                showBlockModal();
                var intervalId = setInterval(function () {
                    clearInterval(intervalId);
                    hideBlockModal();
                }, 1000);
                return true;
            }
            function pushShowOshiraseButton() {
                if (#{indexBean.checkOshirase()}) {
                    $('input[id$=showOshiraseButton]').click();
                }
            }
            
            $(document).on("keydown", function () {
                if (keyBlock)
                    return false;  //ブロック中は全てのキー無効
                if (event.keyCode === 13) {
                    if (event.target.type === "button" || event.target.type === "submit" || event.target.type === "select-one"
                            || event.target.nodeName === "A" || event.target.type === "textarea") {
                        return true;  //button,linkのenterは許容
                    }
                    return false;
                }
                return true;
            });
            var actionChangeCheck;
            window.onunload = function () {
                //console.log("onunload");
                hideBlockModal(true);
            };
        </script>
    #{loginBean.setRequestUrl(request.requestURI)}
    <ui:include src="/html/common/functionNoUseDialog.xhtml" />
    <ui:include src="/html/common/apikeyDialog.xhtml" />
</body>
</html>
