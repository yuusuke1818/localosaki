<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:cust="http://xmlns.jcp.org/jsf/component"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:outputStylesheet library="css" name="common/popup.css"/>
    <h:outputStylesheet library="css" name="common/searchBuildingMulti.css"/>
    <rich:popupPanel id="commonSearchMultiBuildingDialog" modal="true" moveable="true" resizeable="false"
                     minWidth="800" maxWidth="800" 
                     top="20" width="800" height="600" domElementAttachment="form" zindex="150" onshow="checkAutoFocusOnShowRichPanel(event);">
        <!-- z-index:150 ヘッダ部分の後ろに隠れるのを避ける為 -->

        <f:facet name="header">
            <div class="pop_title_area">
                <div class="left">
                    <span class="pop_page_title">建物・テナント検索</span>
                </div>
                <h:form id="commonSearchMultiBuildingCloseForm">
                    <a4j:commandButton value=" " 
                                       id="closeBtn"
                                       style="position:absolute;
                                       top:11px;
                                       right:5px;
                                       background-image:url('#{resource['images/common/com023.png']}');
                                       width:30px;
                                       height:30px;
                                       background-repeat: no-repeat;
                                       border: 0px;
                                       background-color: #FFF;
                                       cursor: pointer;"
                                       onclick="#{rich:component('commonSearchMultiBuildingDialog')}.hide();"
                                       execute="commonSearchMultiBuildingDialog"
                                       render="commonSearchMultiBuildingForm #{rich:clientId('buildingNo')}"
                                       actionListener="#{commonSearchMultiBuildingBean.clearBuildingForm()}"/>
                </h:form>
            </div>
        </f:facet>
        <form jsfc="h:form" id="commonSearchMultiBuildingForm">
            <div class="inner_content content_width">
                <div class="search_description">
                    <p>検索条件を設定して [検索開始] を押してください。</p>
                </div>

                <!-- 動的検索条件テーブル -->
                <rich:dataTable id="searchConditionTable" rows="0"
                                value="#{commonSearchMultiBuildingBean.conditionList}"
                                var="item" 
                                style="margin-top: 5px;
                                width: 703px;
                                border: 0px;
                                table-layout: fixed;">
                    <!--検索条件表示部分 -->
                    <span jsfc="h:column" styleClass="condition_msg" style="width: 10%; border:0px">
                        <h:selectOneMenu  id="selectConditionCd" value="#{item.selectConditionCd}" styleClass="SELECT001" rendered="#{item.selectEnable}"
                                          style="height: 25px;">
                            <f:ajax execute="commonSearchMultiBuildingForm:searchConditionTable" 
                                    render="commonSearchMultiBuildingForm:searchConditionTable" 
                                    event="change" 
                                    listener="#{commonSearchMultiBuildingBean.changeConditionCd(item.orderNo)}" 
                                    onevent="autoFocusOnSelectCondition" />
                            <option jsfc="f:selectItems" value="#{item.selectConditionMap}" />
                        </h:selectOneMenu>
                        <h:outputText value="#{item.selectConditionCd}" rendered="#{item.selectDisable}" />
                    </span>
                    <!--「が」表示部分 -->
                    <span jsfc="h:column" style="width: 5%; text-align: center; border:  0px;">
                        <input jsfc="h:outputText" value="が" style="width: 100%;text-align: center" rendered="#{!item.selectEnable}"/>
                    </span>
                    <!--ドロップダウンリストまたは検索キーワード表示部分 -->
                    <span jsfc="h:column" style="width: 30%; border:  0px;">
                        <!-- 都道府県 -->
                        <h:selectOneMenu id="prefectureCd" value="#{item.prefectureCd}" styleClass="SELECT001" rendered="#{item.prefectureSelectEnable}"
                                         style="width: 100%; height: 25px;" onkeydown="searchPopupConditionKeydown()">
                            <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.prefectureMap}" />
                        </h:selectOneMenu>
                        
                        <!-- 建物グルーピング -->
                        <h:panelGrid class="table_condition_grouping_pop" 
                                     columnClasses="table_condition_grouping_col_item_pop,table_condition_grouping_col_pop,table_condition_grouping_col_item_pop,table_condition_grouping_col_pop"
                                     columns="4"  
                                     rendered="#{item.groupingEnable}">
                            <h:outputText value="親ｸﾞﾙｰﾌﾟ" />
                            <h:selectOneMenu id="conditionCommonParentGroupId" value="#{item.parentGroupId}" styleClass="SELECT001"
                                             style="width: 100%; height: 25px;" onkeydown="searchConditionKeydown()">
                                <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.parentGroupMap}" />
                                <f:ajax event="change" 
                                        execute="conditionCommonParentGroupId" 
                                        render="conditionCommonChildGroupId"/>
                            </h:selectOneMenu>
                            <h:outputText value="子ｸﾞﾙｰﾌﾟ" style="padding-left: 10px;"/>
                            <h:selectOneMenu id="conditionCommonChildGroupId" value="#{item.childGroupId}" styleClass="SELECT001" 
                                     style="width: 100%; height: 25px;" onkeydown="searchConditionKeydown()">
                                <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.childGroupMap}" />
                            </h:selectOneMenu>
                        </h:panelGrid>

                        <!--入居形態 -->
                        <h:selectOneMenu id="nyukyoTypeCd" value="#{item.nyukyoTypeCd}" styleClass="SELECT001" rendered="#{item.nyukyoTypeSelectEnable}"
                                         style="width: 100%; height: 25px;" onkeydown="searchPopupConditionKeydown()">
                            <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.nyukyoTypeMap}" />
                        </h:selectOneMenu>
                        <!--建物状況 -->
                        <h:selectOneMenu id="buildingStatusCd" value="#{item.buildingStatusCd}" styleClass="SELECT001" rendered="#{item.buildingStatusSelectEnable}"
                                         style="width: 100%; height: 25px;"  onkeydown="searchPopupConditionKeydown()">
                            <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.buildingStatusMap}" />
                        </h:selectOneMenu>
                        <!--建物・テナント選択 -->
                        <h:selectOneRadio id="buildingTenant" value="#{item.buildingTenant}" styleClass="SELECT001" rendered="#{item.buildingTenantSelectEnable}"
                                          style="width: 100%; height: 25px;"  onkeydown="searchPopupConditionKeydown()">
                            <option jsfc="f:selectItems" value="#{commonSearchMultiBuildingBean.buildingTenantMap}" />
                        </h:selectOneRadio>
                        <!--キーワード -->
                        <h:inputText id="conditionKeyword" value="#{item.conditionKeyword}" styleClass="EDIT002" class="autofocus" rendered="#{item.keywordSelectEnable}" 
                                     style="width: 100%; height: 25px;"  onkeydown="searchPopupConditionKeydown()" maxlength="50"/>
                    </span>
                    <!--「を含む」表示部分 -->
                    <span jsfc="h:column"  style="width: 10%; text-align: center; border:  0px;">
                        <input jsfc="h:outputText" value="#{item.mutchingTypeCd}" rendered="${!empty item.mutchingTypeCd}" style="width: 100%; height: 25px; text-align: center;"/>
                    </span> 

                    <!--削除ボタン表示部分 -->
                    <span jsfc="h:column" styleClass="gradation_type_3 button_medium_2 delete_button" style="width: 10%; border:  0px;">
                        <h:commandButton value="削除" rendered="#{item.deleteButtonEnable}" 
                                         style="width: 100%; height: 25px;">
                            <f:ajax event="click" 
                                    execute="commonSearchMultiBuildingForm:searchConditionTable" render="commonSearchMultiBuildingForm:searchConditionTable" 
                                    listener="#{commonSearchMultiBuildingBean.deleteCondition(item.orderNo)}"/>
                        </h:commandButton>
                        <h:graphicImage class="button_icon" library="images" rendered="#{item.deleteButtonEnable}" name="common/com020.png" />
                    </span> 
                </rich:dataTable>
                <div class="button_search_pop gradation_type_1 button_large_2">
                    <h:commandButton value="検索開始" id="searchBtn" styleClass="transition_button_size color_botton_regist" action="#{commonSearchMultiBuildingBean.search()}">
                        <a4j:ajax execute="@form" render="@form" onbegin="showBlockModal()" oncomplete="hideBlockModal(true)" />
                    </h:commandButton>
                    <h:graphicImage class="button_icon" library="images" name="common/com028.png" />
                </div>
                <!-- 検索結果 -->
                <ui:fragment id="searchResultArea" rendered="#{commonSearchMultiBuildingBean.searchedFlg}">
                    <div class="">
                        <div class="search_result_pop_header_wrap">
                            <div class="page_content_parts" id="listReroad">
                                <div class="search_result_pop_header_left">
                                    検索条件に該当する建物・テナント情報 ：
                                    <span jsfc="h:outputText" class="serach_result_total_count" value="#{commonSearchMultiBuildingBean.buildingSelectPageing.resultCount}件" />
                                </div>
                            </div>
                        </div>
                        <c:if test="#{commonSearchMultiBuildingBean.buildingSelectPageing.resultCount > 0}">
                            <div class="search_result_pop_area">
                                <table align="center" jsfc="h:dataTable" id="result" var="item" value="#{commonSearchMultiBuildingBean.buildingSelectPageing.pageList}" 
                                       class="search_result_pop" 
                                       headerClass="table_header" 
                                       style="width: 100%;"
                                       columnClasses="column_style_building_0, column_style_building_1, column_style_building_2, column_style_building_3, column_style_building_4">
                                    <span jsfc="h:column">
                                        <span jsfc="f:facet" name="header" style="width: 40px;">
                                            <span jsfc="h:outputText" value="選択"/>
                                        </span>
                                            <h:selectBooleanCheckbox id="selectCheckbox" value="#{item.selectFlg}" disabled="#{item.disabledFlg}"/>
                                    </span>
                                    <h:column>
                                        <f:facet name="header">
                                        </f:facet>
                                        <h:panelGrid columns="1">
                                            <h:graphicImage class="button_icon" library="images" name="common/com074.png" rendered="#{item.tenantFlg}" />
                                            <h:graphicImage class="button_icon" library="images" name="common/com075.png" rendered="#{!item.tenantFlg}" />
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">
                                            <h:outputText value="建物・テナント番号&lt;BR&gt;建物・テナント名"  escape="false" />
                                        </f:facet>
                                        <h:panelGrid columns="1">
                                            <h:outputText id="number" value="#{item.buildingNo}" />
                                            <h:outputText id="name" value="#{item.buildingName}" />
                                        </h:panelGrid>
                                    </h:column>
                                    <span jsfc="h:column">
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="住所"/>
                                        </span>
                                        <span jsfc="h:outputText" id="address" value="#{item.buildingAddress}" />
                                    </span>
                                    <h:column>
                                        <f:facet name="header">
                                            <h:outputText value="稼働状況&lt;BR&gt;入居形態"  escape="false" />
                                        </f:facet>
                                        <h:panelGrid columns="1">
                                            <h:outputText id="buildingStatus" value="#{item.buildingStatus}" />
                                            <h:outputText id="nyukyoType" value="#{item.buildingNyukyoType}" />
                                        </h:panelGrid>
                                    </h:column>
                                </table>
                            </div>
                        </c:if>
                    </div>
                    <c:if test="#{commonSearchMultiBuildingBean.buildingSelectPageing.resultCount > 0}">
                        <div>
                            <div align="center" >
                                <div id="paging_area">
                                    <span id="prevButton_area">
                                        <h:commandLink id="prevButton" value="&lt;&nbsp;&nbsp;前へ" actionListener="#{commonSearchMultiBuildingBean.prevPage}" 
                                                       disabled="#{!commonSearchMultiBuildingBean.buildingSelectPageing.isPrevPage()}">
                                            <f:ajax execute="@form" render="@form" />
                                            <f:attribute name="page" value="#{commonSearchMultiBuildingBean.buildingSelectPageing.currentPage}" />
                                        </h:commandLink>
                                    </span>
                                    <cust:pageIndex id="pageJumpButton" value="#{commonSearchMultiBuildingBean.buildingSelectPageing.pageValue}" 
                                                    action="#{commonSearchMultiBuildingBean.pageJump()}" >
                                        <ui:include src="/html/common/paging/index.xhtml" />
                                    </cust:pageIndex>
                                    <span id="nextButton_area">
                                        <h:commandLink id="nextButton" class="nextButton" value="後へ&nbsp;&nbsp;&gt; " actionListener="#{commonSearchMultiBuildingBean.nextPage}" 
                                                       disabled="#{!commonSearchMultiBuildingBean.buildingSelectPageing.isNextPage()}">
                                            <f:ajax execute="@form" render="@form" />
                                            <f:attribute name="page" value="#{commonSearchMultiBuildingBean.buildingSelectPageing.currentPage}" />
                                        </h:commandLink>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </c:if>
                    <div class="center" style="padding-top: 10px;">
                        <span class="button_set_pop gradation_type_1 gradation_type_5 button_large_2 center">
                            <a4j:commandButton id="addBtn" value="追加" 
                                               action="#{commonSearchMultiBuildingBean.select()}"
                                               execute="commonSearchMultiBuildingForm" render="commonSearchMultiBuildingForm #{reflectControl} #{rich:clientId('searchResultArea')} #{rich:clientId('buildingNo')}"
                                               onbegin="showBlockModal();" oncomplete="hideBlockModal(true); #{rich:component('commonSearchMultiBuildingDialog')}.hide();" >
                                <h:graphicImage style="pointer-events: none; position: absolute; margin-top: 10px; margin-left: 8px;" library="images" name="common/com067.png" />
                            </a4j:commandButton>
                        </span>
                    </div>
                </ui:fragment>
            </div>
        </form>
    </rich:popupPanel>
</html>

