<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:cust="http://xmlns.jcp.org/jsf/component"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:jsf="http://xmlns.jcp.org/jsf">
<div class="contents_form_area" style="margin-top: 0;">
    <rich:messages styleClass="errSearch errArea" />
    <div class="contents_title contents_accordion_header">
        <h:graphicImage class="button_icon button_opener" library="images"
            name="demand/demand_container_opner.png" style="display: none" />
        <h:graphicImage class="button_icon button_closer" library="images"
            name="demand/demand_container_closer.png" />
        <span class="contents_title_body">表示条件</span>
    </div>
    <div class="contents_area contents_accordion_body">
        <div class="head">表示内容を変更したい場合は、下記を変更し、[ 表示更新 ]ボタンを押してください。</div>
        <h:form id="ocrSearchForm">
            <div class="body">
                <div jsfc="a4j:outputPanel" id="o1SearchConditionPanel">
                    <div class="conditions">
                        <div>
                            <label class="TXT008 L1">接続先</label>
                            <f:ajax event="change"
                                render="s1SearchConditionPanel
                                        p1SearchConditionPanel
                                        h1SearchConditionPanel
                                        o1SearchConditionPanel"
                                listener="#{smsCollectSettingMeterMeterManagementBean.changeDevIdSel(smsCollectSettingMeterMeterManagementBean.ocrProperty.devId)}">
                                <select jsfc="h:selectOneMenu"
                                    value="#{smsCollectSettingMeterMeterManagementBean.ocrProperty.devId}"
                                    class="SEL1 selDev sDevIdSel autofocus">
                                    <option jsfc="f:selectItems"
                                        value="#{smsCollectSettingMeterMeterManagementBean.devIdMap}" />
                                </select>
                            </f:ajax>
                        </div>
                        <c:if test="#{!smsCollectSettingMeterMeterManagementBean.pagerMap.isEmpty()}">
                            <div>
                                <label class="TXT008 L2">メーター表示切替</label> <select
                                    jsfc="h:selectOneMenu"
                                    value="#{smsCollectSettingMeterMeterManagementBean.page}"
                                    class="SEL2">
                                    <option jsfc="f:selectItems"
                                        value="#{smsCollectSettingMeterMeterManagementBean.pagerMap}" />
                                </select>
                            </div>
                        </c:if>
                    </div>
                </div>
            </div>
            <div class="foot">
                <div class="gradation_type_1 button_large_2">
                    <h:graphicImage class="button_icon" library="images"
                        name="common/com015.png" />
                    <button jsfc="a4j:commandButton" id="o1ReloadButton"
                        class="button_width edit_search_start o1ReloadButton" value="表示更新"
                        action="#{smsCollectSettingMeterMeterManagementBean.searchMeterInfo()}"
                        execute="@form"
                        render="#{rich:clientId('oTablePanel')}
                            smsCollectSettingMeterMeterManagementBean:ocrEditForm
                            smsCollectSettingMeterMeterManagementBean:o3DevNamePanel
                            smsCollectSettingMeterMeterManagementBean:ocrFileName
                            buttonsAreaO"
                onbegin="showBlockModal()"
                oncomplete="setErrMsgArea('1'); changeDispListMode('O'); hideBlockModal();" />
                </div>
            </div>
        </h:form>
    </div>
    <div class="contents_body">
        <div class="gradation_type_1 button_large_2">
            <h:graphicImage class="button_icon" library="images"
                name="common/com043.png" />
            <a4j:commandButton
                    value="帳票出力"
                    event="click"
                    execute="@form"
                    actionListener="#{smsCollectSettingMeterMeterManagementBean.downloadCsvFile()}"
                    onbegin="showBlockModal()"
                    oncomplete="setErrMsgArea('1');
                                if(!#{smsCollectSettingMeterMeterManagementBean.hasError()}) {
                                    $('input[id$=downloadFileStartCsvOcr]').click();
                                }
                                hideBlockModal();" />
            <button jsfc="h:commandButton" id="downloadFileStartCsvOcr" style="display: none;" action="#{smsCollectSettingMeterMeterManagementBean.downloadFileStart()}" />
        </div>
        <div class="buttons" jsf:id="buttonsAreaO">
            <div class="button button_list gradation_type_1 button current">
                <h:graphicImage class="button_icon" library="images"
                    name="meterManage/btn_list.png" />
                <input id="btnO1List" type="button" data-type="o1" value="一覧表示" />
            </div>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
                <c:if test="#{smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_5 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_regist.png" />
                        <input type="button" data-type="o2" value="API取得" disabled="true" />
                    </div>
                </c:if>
                <c:if test="#{!smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_3 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_regist.png" />
                        <input type="button" data-type="o2" value="API取得" />
                    </div>
                </c:if>
                <!-- listMaxにて設定した台数以降も一括登録で更新はできるようにしたいため以下コメントアウト -->
                <!-- なお一括登録で新規登録の場合はlistMax以降の台数はエラーとなるようにバリデーションチェックは追加済 -->
                <!-- <c:if test="#{smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_5 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_lumpRegist.png" style="left:15px;"/>
                        <input type="button" data-type="o3" value="一括登録" style="width:100px" disabled="true" />
                    </div>
                </c:if>
                <c:if test="#{!smsCollectSettingMeterMeterManagementBean.listMax}"> -->
                    <div class="button button_new gradation_type_3 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_lumpRegist.png" style="left:15px;"/>
                        <input type="button" data-type="o3" value="一括登録・更新" style="width:100px" />
                    </div>
                <!-- </c:if> -->
            </c:if>
            <div class="button button_edit btn_edit gradation_type_5 button current">
                <h:graphicImage class="button_icon" library="images"
                    name="meterManage/btn_editAndDelete.png" />
                <input type="button" data-type="o4" value="編集・削除" disabled="true" />
            </div>
        </div>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="o2" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ API取得 ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/ocr/getApi.xhtml" />
            </div>
        </c:if>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="o3" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ 一括登録・更新 ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/ocr/lumpRegist.xhtml" />
            </div>
        </c:if>

        <div id="o4" style="display: none;" class="editSreen">
            <!-- ■■■■■■■■■■■■■■■■■■ 登録内容変更・削除 ■■■■■■■■■■■■■■■■■■ -->
            <ui:include
               src="/html/sms/collect/setting/meter/tab/ocr/edit.xhtml" />
        </div>

        <!-- 全件の件数を保持 -->
        <h:panelGroup styleClass="oDispCnt">
            <h:inputHidden value="#{smsCollectSettingMeterMeterManagementBean.dispCnt}" />
        </h:panelGroup>
        <div jsfc="a4j:outputPanel" id="oTablePanel">
            <!-- 検針結果一覧 -->
            <div class="search_result_pop_header_wrap">
                <div class="page_content_parts">
                    <div class="search_result_pop_header_left">
                        検索条件に該当するAieLink用メーター情報 <span jsfc="h:outputText"
                            class="serach_result_total_count"
                            value="#{smsCollectSettingMeterMeterManagementBean.dispCnt}" />
                        件
                    </div>
                </div>
            </div>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.dispCnt != '0'}">
                <div class="tbl contents_table">
                    <div class="search_result_area">
                    <form jsfc="h:form" id="ocrListFrom">
                        <rich:extendedDataTable id="resultMeterData" var="item" frozenColumns="6" class="oTbl"
                                    value="#{smsCollectSettingMeterMeterManagementBean.meterList}"
                                    cellpadding="0"
                                    selectionMode="none"
                                    rendered="#{!smsCollectSettingMeterManagementBean.meterList.isEmpty()}"
                                    columnClasses="column_style_checkbox, column_style_mng_id, column_style_user_code, column_style_tenant_name,
                                                   column_style_meter_id, column_style_type, column_style_handy_type, column_style_multi,
                                                   column_style_wireless_id, column_style_hop1_id, column_style_hop2_id, column_style_hop3_id,
                                                   column_style_polling_id, column_style_exam_end_ym">
                            <rich:column headerClass="table_header" width="45px">
                                <f:facet name="header">
                                    <f:ajax event="click"
                                        execute="@form"
                                        listener="#{smsCollectSettingMeterMeterManagementBean.checkBoxOperationAll()}"
                                        render="#{rich:clientId('oTablePanel')}
                                                    smsCollectSettingMeterMeterManagementBean:ocrCurrentValueForm:o6MeterMngIdListPanel"
                                        onevent="allCheckboxClick">
                                        <h:commandLink style="color:#FFF" value="選択"></h:commandLink>
                                    </f:ajax>
                                </f:facet>

                                <div jsfc="a4j:outputPanel" id="oTableCheckPanel">
                                    <f:ajax event="change" execute="@form"
                                        render="smsCollectSettingMeterMeterManagementBean:ocrEditForm:o4Panel
                                                smsCollectSettingMeterMeterManagementBean:ocrCurrentValueForm:o6MeterMngIdListPanel
                                                smsCollectSettingMeterMeterManagementBean:ocrNowValBtnForm"
                                        listener="#{smsCollectSettingMeterMeterManagementBean.checkBoxOperation()}">
                                        <h:selectBooleanCheckbox id="targetCheckBox"
                                            value="#{item.checkBox}" />
                                    </f:ajax>
                                </div>
                            </rich:column>
                            <rich:column headerClass="table_header" width="80px">
                                <f:facet name="header">
                                    管理番号
                                </f:facet>
                                <h:outputText id="meterMngId" value="#{item.meterMngId}" />
                            </rich:column>
                            <rich:column headerClass="table_header" width="120px">
                                <f:facet name="header">
                                    ユーザーコード
                                </f:facet> <h:outputText id="tenantId"
                                    value="#{item.tenantId}" rendered="#{item.tenantId != null}" /> <h:outputText
                                    id="tenantIdBlank" value="-" rendered="#{item.tenantId == null}" />
                            </rich:column>
                            <rich:column headerClass="table_header" width="250px">
                                <f:facet name="header">
                                    テナント番号<br />
                                    テナント名
                                </f:facet> <ui:fragment
                                    rendered="#{item.buildingNo != null}">
                                    <h:outputText id="buildingNo" value="#{item.buildingNo}" />
                                    <br />
                                    <h:outputText id="buildingName" value="#{item.buildingName}" />
                                </ui:fragment> <h:outputText id="buildingNoBlank" value="-"
                                    rendered="#{item.buildingNo == null}" />
                            </rich:column>
                            <rich:column headerClass="table_header" width="100px">
                                <f:facet name="header">
                                    計器ID
                                </f:facet>
                                <h:outputText id="meterId" value="#{item.meterId}" />
                            </rich:column>
                            <rich:column headerClass="table_header" width="100px">
                                <f:facet name="header">
                                    種別
                                </f:facet>
                                <h:outputText id="meterTypeName" value="#{item.meterTypeName}" />
                            </rich:column>
                            <rich:column headerClass="table_header" width="196px">
                                <f:facet name="header">
                                    検満年月
                                </f:facet>
                                <ui:fragment rendered="${item.dispYearFlg == '0'}">
                                    <h:outputText id="examEndYm" value="#{item.examEndYm}" />
                                </ui:fragment>
                                <ui:fragment rendered="${item.dispYearFlg == '1'}">
                                    <h:outputText id="examEndYmWareki" value="#{item.examEndYmWareki}" />
                                </ui:fragment>
                            </rich:column>
                        </rich:extendedDataTable>
                    </form>
                    </div>
                </div>
            </c:if>
        </div>
    </div>
</div>
</html>
