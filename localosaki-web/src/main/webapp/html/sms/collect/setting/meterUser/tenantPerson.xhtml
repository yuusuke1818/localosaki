<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:oslib="http://osaki.co.jp/base-component"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:cust="http://xmlns.jcp.org/jsf/component"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:a4j="http://richfaces.org/a4j">
    <h:head>
        <title>担当テナント設定</title>
    </h:head>
    <h:body>
        <ui:composition template="/html/template/template_collect_sidemenu.xhtml">
            <ui:define name="content_side">
                <h:outputStylesheet library="css" name="sms/collect/setting/meterUser/tenantPerson.css"/>
                <form jsfc="h:form"  id="smsCollectSettingMeterUserTenantPersonBean">
                    <div class="inner_content">
                        <div class="title_area_warp">
                            <!-- 画面タイトル -->
                            <div class="title_area_left">
                                <h2 class="page_title">担当テナント設定</h2>
                                <!-- ヘルプボタン -->
                                <c:if test="#{indexBean.userGuideBool}">
                                    <h:commandLink class="help_icon" action="#{indexBean.userGuide()}" target="_blank" />
                                </c:if>
                                <p class="page_subtitle">
                                    <h:outputText value="ユーザーが担当するテナントの設定ができます。" />
                                </p>
                            </div>
                            <div class="clear" />

                        <ui:remove>
                            <!-- メッセージ表示部分 -->
                            <span class="rf-msgs">
                                <c:forEach items="#{smsCollectSettingMeterUserEditBean.infoMessages}" var="msg">
                                    <div class="rf-msg-inf"><h:outputText class="rf-msgs-sum" value="#{msg}" /></div>
                                </c:forEach>
                                <c:forEach items="#{smsCollectSettingMeterUserEditBean.errorMessages}" var="msg">
                                    <div class="rf-msgs-err"><h:outputText class="rf-msgs-sum" value="#{msg}" /></div>
                                </c:forEach>
                            </span>
                         </ui:remove>

                        <rich:messages id="messages"/>

                        <div class="contents_title">企業情報</div>
                        <div class="contents_area">
                            <table class="search_condition_area">
                                <tr>
                                    <td style="width: 140px;" class="TXT008">企業ID</td>
                                    <td style="width: auto;"><span jsfc="h:outputText" id="targetCorpId" styleClass="TXT020"
                                        value="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.targetCorpId}" style="display: inline-block; width: 280px; word-wrap: break-word;" /></td>
                                    <td style="width: 140px;" class="TXT008">企業名</td>
                                    <td style="width: auto;"><span jsfc="h:outputText" id="targetCorpName" styleClass="TXT020"
                                        value="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.targetCorpName}" style="display: inline-block; width: 280px; word-wrap: break-word;" /></td>
                                </tr>
                            </table>
                        </div>

                        <div class="contents_title">ユーザー情報</div>
                        <div class="contents_area">
                            <table class="search_condition_area">
                                <tr>
                                    <td style="width: 140px;" class="TXT008">ユーザーID</td>
                                    <td style="width: auto;"><span jsfc="h:outputText" id="selectPersonId" styleClass="TXT020"
                                        value="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.selectPersonId}" style="display: inline-block; width: 280px; word-wrap: break-word;" /></td>
                                    <td style="width: 140px;" class="TXT008">ユーザー名</td>
                                    <td style="width: auto;"><span jsfc="h:outputText" id="selectPersonName" styleClass="TXT020"
                                        value="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.selectPersonName}" style="display: inline-block; width: 280px; word-wrap: break-word;" /></td>
                                </tr>
                            </table>
                        </div>

                        <span jsfc="h:outputLabel"></span>

                        <div class="search_description">
                            <p>検索条件を設定して[検索開始]を押してください。<br />※設定後は登録ボタンを押してください。</p>
                        </div>
                        <div class="gradation_type_1">

                        <a4j:outputPanel id="commonSearchResult" >
                            <!-- 動的検索条件テーブル -->
                            <rich:dataTable id="searchConditionTable" rows="0"
                                            value="#{smsCollectSettingMeterUserTenantPersonBean.conditionList}"
                                            var="item"
                                            style="margin-top: 5px;
                                            width: 100%;
                                            border: 0px;
                                            table-layout: fixed;">

                                <!--検索条件表示部分 -->
                                <span jsfc="h:column" styleClass="condition_msg" style="width: 25%; border:0px">
                                    <h:selectOneMenu  id="selectConditionCd" value="#{item.selectConditionCd}" styleClass="check_change SELECT001" rendered="#{item.selectEnable}"
                                                      style="height: 25px;">
                                        <f:ajax execute="smsCollectSettingMeterUserTenantPersonBean:searchConditionTable" render="smsCollectSettingMeterUserTenantPersonBean:searchConditionTable"
                                            event="change" listener="#{smsCollectSettingMeterUserTenantPersonBean.changeConditionCd(item.orderNo)}" />
                                        <option jsfc="f:selectItems" value="#{item.selectConditionMap}" />
                                    </h:selectOneMenu>
                                    <h:outputText value="#{item.selectConditionCd}" rendered="#{item.selectDisable}" id="selectConditionCdValue"/>
                                </span>

                                <!--接続詞表示部分 -->
                                <span jsfc="h:column" style="width: 5%; text-align: center; border:  0px;">
                                    <input jsfc="h:outputText" value="#{item.searchSubjectConjunction}" style="width: 100%;text-align: center" rendered="#{!item.selectEnable}"/>
                                </span>

                                <!--ドロップダウンリストまたは検索キーワード表示部分 -->
                                <span jsfc="h:column" style="width: 40%; border:  0px; position:relative">
                                    <!-- 都道府県 -->
                                    <h:selectOneMenu value="#{item.prefectureCd}" rendered="#{item.prefectureSelectEnable}" styleClass="check_change SELECT001" style="width: 100%; height: 25px;" id="prefectureCd" onkeydown="searchConditionKeydown()">
                                        <option jsfc="f:selectItems" value="#{smsCollectSettingMeterUserTenantPersonBean.prefectureMap}" />
                                    </h:selectOneMenu>
                                    <!-- 建物状況 -->
                                    <h:selectOneMenu value="#{item.buildingStatusCd}" rendered="#{item.buildingStatusSelectEnable}" styleClass="check_change SELECT001" style="width: 100%; height: 25px;" id="buildingStatusCd" onkeydown="searchConditionKeydown()">
                                        <option jsfc="f:selectItems" value="#{smsCollectSettingMeterUserTenantPersonBean.buildingSituationMap}" />
                                    </h:selectOneMenu>

                                    <!--キーワード or ユーザーコード-->
                                    <h:inputText id="conditionKeyword" value="#{item.conditionKeyword}" styleClass="check_change EDIT002" class="autofocus" rendered="#{item.keywordSelectEnable}"
                                        style="width: 100%; height: 25px;" maxlength="#{smsCollectSettingMeterUserTenantPersonBean.getConditionKeywordMaxLength(item.tenantIdSelectEnable)}"
                                        onkeydown="searchConditionKeydown()" />

                                </span>

                                <!--「を含む」表示部分 -->
                                <span jsfc="h:column"  style="width: 20%; text-align: center; border:  0px;">
                                    <input jsfc="h:outputText" value="#{item.mutchingTypeCd}" rendered="${!empty item.mutchingTypeCd}" style="width: 100%; height: 25px; text-align: center;"/>
                                </span>

                                <!--削除ボタン表示部分 -->
                                <span jsfc="h:column" styleClass="gradation_type_3 button_medium_2 delete_button" style="width: 10%; border:  0px;">
                                    <h:commandButton value="削除" rendered="#{item.deleteButtonEnable}"
                                                     style="width: 100%; height: 25px;" id="deleteBtn">
                                        <f:ajax event="click" execute="smsCollectSettingMeterUserTenantPersonBean:searchConditionTable"
                                            render="smsCollectSettingMeterUserTenantPersonBean:searchConditionTable" listener="#{smsCollectSettingMeterUserTenantPersonBean.deleteCondition(item.orderNo)}"/>
                                    </h:commandButton>
                                    <h:graphicImage class="button_icon" library="images" rendered="#{item.deleteButtonEnable}" name="common/com020.png" />
                                </span>

                            </rich:dataTable>
                            <!-- 汎用ユーザー検索結果格納場所 -->
                            <h:inputHidden id="commonSearchUser_personId" value="#{smsCollectSettingMeterUserTenantPersonBean.personId}"></h:inputHidden>
                            <h:inputHidden id="commonSearchUser_personIdName" value="#{smsCollectSettingMeterUserTenantPersonBean.personIdName}"></h:inputHidden>
                        </a4j:outputPanel>
                        </div>

                        <!-- 検索条件 大枠 -->
                        <div class="contents_center button_search gradation_type_1 button_large_2">
                            <a4j:commandButton
                                id="searchButton"
                                class="search_action_button"
                                value="検索開始"
                                execute="@form"
                                render="@form"
                                action="#{smsCollectSettingMeterUserTenantPersonBean.searchPersonInMeterTenant()}"
                                onbegin="showBlockModal()"
                                oncomplete="hideBlockModal()"
                                >
                            </a4j:commandButton>
                            <h:graphicImage class="button_icon" library="images" name="common/com028.png" />
                        </div>

                        <ui:fragment rendered="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.searchFlg}">
                            <div class="search_result_header_wrap">
                                <div class="search_result_header_left">
                                    検索条件に該当するテナント情報<span class="serach_result_total_count" jsfc="h:outputText" value="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.resultCount}" id="resultCount"/>件
                                </div>
                                <br/>
                            </div>
                            <div>
                                <span class="regist_info">担当テナント</span>
                                <span class="serach_result_total_count" jsfc="h:outputText" id="tbuildingPersonCnt"
                                    value="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.tbuildingPersonCnt}" />
                                <span class="regist_info">件</span>
                            </div>

                            <ui:fragment rendered="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.resultCount > 0}">
                            <div class="contents_title">一括選択</div>
                            <div class="contents_area">
                                <table style="margin-left: 80px;">
                                    <tr>
                                        <td class="select_button_area" style="width: 420px;">
                                            <div class="TXT008">全ページ</div>
                                            <table>
                                                <tr>
                                                    <td class="button_select gradation_type_1 button_medium_2 gradation_type_5">
                                                        <h:commandButton class="search_action_button" value="選択" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.allSelected()}"
                                                                         disabled="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.isAllSelectDisabled()}" id="allSelectedBtn">
                                                            <a4j:ajax execute="@this" render="buildingSearchResult" onbegin="setChangeFlag();showBlockModal()" oncomplete="hideBlockModal()" />
                                                        </h:commandButton>
                                                        <h:graphicImage class="button_icon" library="images" name="common/com047.png" />
                                                    </td>
                                                    <td class="button_release gradation_type_1 button_medium_2 gradation_type_5">
                                                        <h:commandButton class="search_action_button" value="解除" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.allUnSelected()}"
                                                                         disabled="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.isAllSelectDisabled()}" id="allUnSelectedBtn">
                                                            <a4j:ajax execute="@this" render="buildingSearchResult" onbegin="setChangeFlag();showBlockModal()" oncomplete="hideBlockModal()" />
                                                        </h:commandButton>
                                                        <h:graphicImage class="button_icon" library="images" name="common/com048.png" />
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="select_button_area" style="width: 420px;">
                                            <div class="TXT008">現在ページ</div>
                                            <table>
                                                <tr>
                                                    <td class="button_all_select gradation_type_1 button_medium_2 gradation_type_5">
                                                        <h:commandButton class="search_action_button" value="選択" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.currentAllSelected()}"
                                                            disabled="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.isCurrentSelectDisabled()}" id="currentAllSelectedBtn">
                                                            <a4j:ajax execute="@this" render="buildingSearchResult" onbegin="setChangeFlag();showBlockModal()" oncomplete="hideBlockModal()" />
                                                        </h:commandButton>
                                                        <h:graphicImage class="button_icon" library="images" name="common/com047.png" />
                                                    </td>
                                                    <td class="button_all_release gradation_type_1 button_medium_2 gradation_type_5">
                                                        <h:commandButton class="search_action_button" value="解除" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.currentAllUnSelected()}"
                                                            disabled="#{smsCollectSettingMeterUserTenantPersonBean.tenantPersonSearchBeanProperty.isCurrentSelectDisabled()}" id="currentAllUnSelectedBtn">
                                                            <a4j:ajax execute="@this" render="buildingSearchResult" onbegin="setChangeFlag();showBlockModal()" oncomplete="hideBlockModal();" />
                                                        </h:commandButton>
                                                        <h:graphicImage class="button_icon" library="images" name="common/com048.png" />
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- 検索情報ページングフッタにページネート -->
                            <a4j:outputPanel id="buildingSearchResult" >
                                <table align="center" jsfc="h:dataTable" id="result"
                                       var="item" value="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.pageList}"
                                       class="search_result_area" headerClass="table_header"
                                       columnClasses="column_style_building_tenant, column_style_building_tenant_id, column_style_building_no_name, column_style_building_address, column_style_building_Status, column_style_building_person_flg">
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                        </span>
                                        <h:graphicImage class="button_icon" library="images" name="common/com074.png" rendered="#{item.tenantFlg}" />
                                        <h:graphicImage class="button_icon" library="images" name="common/com075.png" rendered="#{!item.tenantFlg}" />
                                    </span>
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="ユーザーコード"/><br/>
                                        </span>
                                        <span jsfc="h:outputText" id="userCode" value="#{item.tenantId}" class="TXT008_margin" />
                                    </span>
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="テナント番号"/><br/>
                                            <span jsfc="h:outputText" value="テナント名"/>
                                        </span>
                                        <span jsfc="h:outputText" id="buildingNo" value="#{item.buildingNo}" class="TXT008_margin"/><br/>
                                        <span jsfc="h:outputText" id="buildingName" value="#{item.buildingName}" class="TXT008_margin" />
                                    </span>
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="住所"/>
                                        </span>
                                        <span jsfc="h:outputText" id="prefectureName" value="#{item.prefectureName}" class="TXT008_margin" />
                                        <span jsfc="h:outputText" id="address" value="#{item.address}" />
                                        <span jsfc="h:outputText" id="addressBuilding" value="#{item.addressBuilding}" />
                                    </span>
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="稼働状況"/>
                                        </span>
                                        <span jsfc="h:outputText" id="buildingStatus" value="#{item.buildingStatus}" class="TXT008_margin"/>
                                    </span>
                                    <span jsfc="h:column" >
                                        <span jsfc="f:facet" name="header">
                                            <span jsfc="h:outputText" value="担当"/>
                                        </span>
                                            <h:selectBooleanCheckbox onclick="setChangeFlag();" class="check_change" id="buildingPersonFlg1" value="#{item.buildingPersonFlg}" >
                                            </h:selectBooleanCheckbox>
                                    </span>
                                </table>
                                <!-- ページング -->
                                <div class="contents_center">
                                    <div id="paging_area">
                                        <span id="prevButton_area">
                                            <h:commandLink id="prevButton" value="&lt;&nbsp;&nbsp;前へ" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.prevPage}"
                                                           disabled="#{!smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.isPrevPage()}">
                                                <f:ajax execute="@form" render="@form" />
                                                <f:attribute name="page" value="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.currentPage}" />
                                            </h:commandLink>
                                        </span>
                                        <cust:pageIndex id="pageJumpButton" value="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.pageValue}"
                                                        action="#{smsCollectSettingMeterUserTenantPersonBean.pageJump()}" >
                                            <ui:include src="/html/common/paging/index.xhtml" />
                                        </cust:pageIndex>
                                        <span id="nextButton_area">
                                            <h:commandLink id="nextButton" class="nextButton" value="後へ&nbsp;&nbsp;&gt; " actionListener="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.nextPage}"
                                                           disabled="#{!smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.isNextPage()}">
                                                <f:ajax execute="@form" render="@form" />
                                                <f:attribute name="page" value="#{smsCollectSettingMeterUserTenantPersonBean.userTenantPersonPaging.currentPage}" />
                                            </h:commandLink>
                                        </span>
                                    </div>
                                </div>
                                <span jsfc="f:facet" name="header">
                                    <span jsfc="h:outputText" value="担当企業権限"/>
                                </span>
                                <div class="contents_center button_regist gradation_type_1 button_large_2">
                                    <a4j:commandButton class="search_action_button" value="登録" actionListener="#{smsCollectSettingMeterUserTenantPersonBean.registPersonInMeterTenant()}" id="registPersonInMeterTenantBtn" onclick="return confirmDialog_regist();"
                                                       execute="@form" render="@form" onbegin="showBlockModal();" oncomplete="hideBlockModal();clearChangeFlag();">
                                    </a4j:commandButton>
                                    <h:graphicImage class="button_icon" library="images" name="common/com067.png" />
                                </div>
                            </a4j:outputPanel>
                            </ui:fragment>
                        </ui:fragment>
                        <!--アクセストークン用-->
                        <oslib:requestToken />
                        </div>
                    </div>

                    <ui:include src="/html/common/changeCautionDialog.xhtml" >
                        <!-- ボタンに対応する場合 -->
                        <ui:param name="cautionDialogId" value="editCautionDialog" />
                    </ui:include>
                    <ui:include src="/html/common/confirmationDialog.xhtml" >
                        <ui:param name="confirmationDialogTitle" value="確認" />
                        <ui:param name="confirmationDialogMessage" value="#{smsCollectSettingMeterUserTenantPersonBean.getBeforeRegisterMessage()}" />
                    </ui:include>
                    <script type="text/javascript">
                        function confirmDialog_regist(){
                            if(confirmationDialogOpen( $('input[id$=registPersonInMeterTenantBtn]') )){
                                return true;
                            }
                            return false;
                        }
                    </script>
                </form>
                <!-- ユーザー汎用検索 -->
                <ui:include src="/html/common/search_user.xhtml" >
                    <ui:param name="reflectControl" value="commonSearchResult" />
                </ui:include>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

