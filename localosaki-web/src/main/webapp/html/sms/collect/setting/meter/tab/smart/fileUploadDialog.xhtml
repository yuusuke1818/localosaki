<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    
    <script>
        // 画面遷移時と、バリデーションエラー時にファイル名を削除する
        window.onload = function ()
        {
            clearFileName();
        };

        // ファイルが選択されたときに、ファイル名を表示する
        function changeFile() {
            var file = $('input[type=file]').prop('files')[0];
            $('.filename_dialog').html(htmlEscape(file.name));
        }

        // // input type="file" タグを再作成する（初期化のため）
         function remakeInputFile() {
             var file = $('.upload_button');
             file.parentNode.innerHTML = file.parentNode.innerHTML;
        }

        // ファイル名を初期化する
        function clearFileName() {
            $('.filename_dialog').html('');
            $('.file_input_name').val('');
        }
    </script>

    <h:outputStylesheet library="css" name="common/popup.css"/>
    <rich:popupPanel id="fileUploadDialog" modal="true" moveable="true" resizeable="false"  
                       top="180" zindex="320" autosized="true"
                       domElementAttachment="parent"
                       onshow="checkAutoFocusOnShowRichPanel(event);">

        <f:facet name="header">
            <div class="pop_title_area">
                <div class="left">
                    <h:outputText class="pop_page_title" value="ファイル選択" />
                </div>
                <div class="pop_button_close">
                    <input type="button" value="" onclick="#{rich:component('fileUploadDialog')}.hide();">
                    </input>
                </div>
            </div>
        </f:facet>
        <div  class="inner_content content_width">

            <table jsfc="h:panelGrid" columns="1" style="width: 100%;">
                <span jsfc="h:column" style="">
                    <h:outputText class="page_subtitle" value="登録データファイルを選択してください" />
                </span>
                <span jsfc="h:column" style="">
                    <h:form id="meterBulkBeanUL" enctype="multipart/form-data">
                        <div class="file">
                                <div class="gradation_type_1 button_medium_2">
                                    <h:commandButton id="file_input_button" class="file_input_button" type="button" style=""
                                                        onclick="
                                                                $('input[id$=file_input]').click();
                                                                return false;" />
                                                                <!-- remakeInputFile(); -->
                                    <h:inputFile id="file_input" 
                                                    class="upload_button"
                                                    label="ファイル名" 
                                                    value="#{smsCollectSettingMeterMeterManagementBean.uploadFile}"
                                                    onchange="changeFile();"
                                                    style="display: none;">
                                        <f:ajax listener="#{smsCollectSettingMeterMeterManagementBean.execFileUpload()}" execute="@form" render="nameError" />
                                    </h:inputFile>
                                    <span class="file_choise_msg">参照</span>
                                    <h:graphicImage class="button_icon btnDownloadIconLayout" library="images" name="common/com038.png" />
                                </div>
                        </div>
                        <span class="file_name filename_dialog" id="dialogFileName" jsfc="h:outputText" value="#{smsCollectSettingMeterMeterManagementBean.uploadFileName}"></span>
                    </h:form>
                </span>
                
                <span jsfc="h:column">
                    <table class="change_caution_button_area" style="text-align: center; margin-left: 13px;">
                        <tr>
                            <td class="gradation_type_1 button_large_2">
                                <h:form>
                                    <a4j:commandButton id="okBtn" value="OK"
                                              style="width:160px;"
                                              render="#{smsCollectSettingMeterMeterManagementBean.reflectControl}"
                                              oncomplete="#{rich:component('fileUploadDialog')}.hide(); return false;"
                                              />
                                    <h:graphicImage style="pointer-events: none;" class="button_icon btnDownloadIconLayout btnFileSelOkIconLayout" library="images" name="common/com067.png" />
                                </h:form>
                            </td>
                        </tr>
                    </table>
                </span>
            </table>
            
        </div>
    </rich:popupPanel>

</html>