<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:cust="http://xmlns.jcp.org/jsf/component"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:jsf="http://xmlns.jcp.org/jsf">
<div class="contents_form_area" style="margin-top: 0;">
    <rich:messages styleClass="errSearch errArea" />
    <div class="contents_title contents_accordion_header">
        <h:graphicImage class="button_icon button_opener" library="images"
            name="demand/demand_container_opner.png" style="display: none" />
        <h:graphicImage class="button_icon button_closer" library="images"
            name="demand/demand_container_closer.png" />
        <span class="contents_title_body">表示条件</span>
    </div>
    <div class="contents_area contents_accordion_body">
        <div class="head">表示内容を変更したい場合は、下記を変更し、[ 表示更新 ]ボタンを押してください。</div>
        <h:form id="pulseSearchForm">
            <div class="body">
                <div jsfc="a4j:outputPanel" id="p1SearchConditionPanel">
                    <div class="conditions">
                        <div>
                            <label class="TXT008 L1">接続先</label>
                            <f:ajax event="change"
                                render="s1SearchConditionPanel
                                        p1SearchConditionPanel
                                        h1SearchConditionPanel
                                        o1SearchConditionPanel"
                                listener="#{smsCollectSettingMeterMeterManagementBean.changeDevIdSel(smsCollectSettingMeterMeterManagementBean.pulseProperty.devId)}">
                                <select jsfc="h:selectOneMenu"
                                    value="#{smsCollectSettingMeterMeterManagementBean.pulseProperty.devId}"
                                    class="SEL1 selDev sDevIdSel autofocus">
                                    <option jsfc="f:selectItems"
                                        value="#{smsCollectSettingMeterMeterManagementBean.devIdMap}" />
                                </select>
                            </f:ajax>
                        </div>
                        <c:if
                            test="#{!smsCollectSettingMeterMeterManagementBean.pagerMap.isEmpty()}">
                            <div>
                                <label class="TXT008 L2">メーター表示切替</label> <select
                                    jsfc="h:selectOneMenu"
                                    value="#{smsCollectSettingMeterMeterManagementBean.page}"
                                    class="SEL2">
                                    <option jsfc="f:selectItems"
                                        value="#{smsCollectSettingMeterMeterManagementBean.pagerMap}" />
                                </select>
                            </div>
                        </c:if>
                    </div>
                </div>
            </div>
            <div class="foot">
                <div class="gradation_type_1 button_large_2">
                    <h:graphicImage class="button_icon" library="images"
                        name="common/com015.png" />
                    <button jsfc="a4j:commandButton" id="p1ReloadButton"
                        class="button_width edit_search_start p1ReloadButton" value="表示更新"
                        action="#{smsCollectSettingMeterMeterManagementBean.searchMeterInfo()}"
                        execute="@form"
                        render="#{rich:clientId('pTablePanel')}
                            smsCollectSettingMeterMeterManagementBean:smartRegistForm:s2ExamNoticeMonthPanel
                            smsCollectSettingMeterMeterManagementBean:smartRegistForm:s2DevNamePanel
                            smsCollectSettingMeterMeterManagementBean:smartRegistForm:s2MeterMngIdMapPanel
                            smsCollectSettingMeterMeterManagementBean:pulseRegistForm:p2ExamNoticeMonthPanel
                            smsCollectSettingMeterMeterManagementBean:pulseRegistForm:p2DevNamePanel
                            smsCollectSettingMeterMeterManagementBean:pulseRegistForm:p2MeterMngIdMapPanel
                            smsCollectSettingMeterMeterManagementBean:p3DevNamePanel
                            smsCollectSettingMeterMeterManagementBean:pulseFileName
                            buttonsAreaP"
                        onbegin="showBlockModal()"
                        oncomplete="setErrMsgArea('1'); changeDispListMode('P'); hideBlockModal();" />
                </div>
            </div>
        </h:form>
    </div>
    <div class="contents_body">
        <div class="gradation_type_1 button_large_2">
            <h:graphicImage class="button_icon" library="images"
                name="common/com043.png" />
            <a4j:commandButton
                    value="帳票出力"
                    event="click"
                    execute="@form"
                    actionListener="#{smsCollectSettingMeterMeterManagementBean.downloadCsvFile()}"
                    onbegin="showBlockModal()"
                    oncomplete="setErrMsgArea('1');
                                if(!#{smsCollectSettingMeterMeterManagementBean.hasError()}) {
                                    $('input[id$=downloadFileStartCsvPulse]').click();
                                }
                                hideBlockModal();" />
            <button jsfc="h:commandButton" id="downloadFileStartCsvPulse" style="display: none;" action="#{smsCollectSettingMeterMeterManagementBean.downloadFileStart()}" />
        </div>
        <div class="buttons" jsf:id="buttonsAreaP">
            <div class="button button_list gradation_type_1 button current">
                <h:graphicImage class="button_icon" library="images"
                    name="meterManage/btn_list.png" />
                <input id="btnP1List" type="button" data-type="p1" value="一覧表示" />
            </div>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
                <c:if test="#{smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_5 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_regist.png" />
                        <input type="button" data-type="p2" value="新規登録" disabled="true" />
                    </div>
                </c:if>
                <c:if test="#{!smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_3 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_regist.png" />
                        <input type="button" data-type="p2" value="新規登録" />
                    </div>
                </c:if>
            </c:if>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
                <!-- listMaxにて設定した台数以降も一括登録で更新はできるようにしたいため以下コメントアウト -->
                <!-- なお一括登録で新規登録の場合はlistMax以降の台数はエラーとなるようにバリデーションチェックは追加済 -->
                <!-- <c:if test="#{smsCollectSettingMeterMeterManagementBean.listMax}">
                    <div class="button button_new gradation_type_5 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_lumpRegist.png" />
                        <input type="button" data-type="p3" value="一括登録" disabled="true" />
                    </div>
                </c:if>
                <c:if test="#{!smsCollectSettingMeterMeterManagementBean.listMax}"> -->
                    <div class="button button_new gradation_type_3 button current">
                        <h:graphicImage class="button_icon" library="images" name="meterManage/btn_lumpRegist.png" />
                        <input type="button" data-type="p3" value="一括登録" />
                    </div>
                <!-- </c:if> -->
            </c:if>
            <div class="button button_edit btn_edit gradation_type_5 button current">
                <h:graphicImage class="button_icon" library="images"
                    name="meterManage/btn_editAndDelete.png" />
                <input type="button" data-type="p4" value="編集・削除" disabled="true" />
            </div>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
               <div class="button button_edit_2 btn_setting gradation_type_5 button current">
                   <h:graphicImage class="button_icon" library="images"
                       name="meterManage/btn_settingEdit.png" />
                   <input type="button" data-type="p5" value="設定変更" disabled="true" />
               </div>
           </c:if>
           <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
               <div class="button button_edit_2 btn_current gradation_type_5 button current">
                   <h:graphicImage class="button_icon" library="images"
                       name="meterManage/btn_currentValue.png" />
                   <input type="button" data-type="p6" value="現在値取得" disabled="true" />
               </div>
           </c:if>
           <c:if test="#{smsCollectSettingMeterMeterManagementBean.osakiAuth}">
                <div class="button button_edit btn_status gradation_type_5 button current">
                    <h:graphicImage class="button_icon" library="images"
                        name="meterManage/btn_meterStatus.png" />
                     <input type="button" data-type="p7" value="ﾒｰﾀｰ状態登録" disabled="true" />
                </div>
            </c:if>
        </div>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="p2" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ 新規登録（個別） ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/pulse/regist.xhtml" />
            </div>
        </c:if>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="p3" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ 新規登録（一括） ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/pulse/lumpRegist.xhtml" />
            </div>
        </c:if>

        <div id="p4" style="display: none;" class="editSreen">
            <!-- ■■■■■■■■■■■■■■■■■■ 登録内容変更・削除 ■■■■■■■■■■■■■■■■■■ -->
            <ui:include
                src="/html/sms/collect/setting/meter/tab/pulse/edit.xhtml" />
        </div>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="p5" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ 設定内容変更 ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/pulse/settingEdit.xhtml" />
            </div>
        </c:if>

        <c:if test="#{smsCollectSettingMeterMeterManagementBean.smsAuthControl}">
            <div id="p6" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ 現在値取得 ■■■■■■■■■■■■■■■■■■ -->
                <ui:include
                    src="/html/sms/collect/setting/meter/tab/pulse/getCurrentValue.xhtml" />
            </div>
        </c:if>
        
        <c:if test="#{smsCollectSettingMeterMeterManagementBean.osakiAuth}">
            <div id="p7" style="display: none;">
                <!-- ■■■■■■■■■■■■■■■■■■ メーター状態登録 ■■■■■■■■■■■■■■■■■■ -->
                <ui:include src="/html/sms/collect/setting/meter/tab/pulse/meterStatus.xhtml" />
            </div>
        </c:if>

        <!-- 全件の件数を保持 -->
        <h:panelGroup styleClass="pDispCnt">
            <h:inputHidden value="#{smsCollectSettingMeterMeterManagementBean.dispCnt}"/>
        </h:panelGroup>
        <div jsfc="a4j:outputPanel" id="pTablePanel">
            <!-- 検針結果一覧 -->
            <div class="search_result_pop_header_wrap">
                <div class="page_content_parts">
                    <div class="search_result_pop_header_left">
                        検索条件に該当するパルスメーター情報 <span jsfc="h:outputText"
                        class="serach_result_total_count"
                        value="#{smsCollectSettingMeterMeterManagementBean.dispCnt}" />
                        件
                    </div>
                </div>
            </div>
            <c:if test="#{smsCollectSettingMeterMeterManagementBean.dispCnt != '0'}">
                <div class="tbl contents_table">
                    <div class="search_result_area">
                        <form jsfc="h:form" id="pulseListFrom">
                            <rich:extendedDataTable id="resultMeterData" var="item" frozenColumns="6" class="pTbl"
                                    value="#{smsCollectSettingMeterMeterManagementBean.meterList}"
                                    cellpadding="0"
                                    selectionMode="none"
                                    columnClasses="column_style_checkbox, column_style_mng_id, column_style_user_code, column_style_tenant_name,
                                                   column_style_meter_id, column_style_type, column_style_pulse_type, column_style_pulse_weight,
                                                   column_style_multi, column_style_concentrator_name, column_style_status,column_style_comment, column_style_exam_end_ym,
                                                   column_style_meterPresSitu, column_style_alertPauseFlg, column_style_alertPause, column_style_meterStatusMemo">
                                <rich:column headerClass="table_header" width="45px">
                                    <f:facet name="header">
                                        <f:ajax event="click"
                                                execute="@form"
                                                listener="#{smsCollectSettingMeterMeterManagementBean.checkBoxOperationAll()}"
                                                render="#{rich:clientId('pTablePanel')} smsCollectSettingMeterMeterManagementBean:pulseCurrentValueForm:p6MeterMngIdListPanel
                                                        smsCollectSettingMeterMeterManagementBean:pulseMeterStatusForm:p7Panel"
                                                onevent="pulseCheckboxClick">
                                        <h:commandLink style="color:#FFF" value="選択"></h:commandLink>
                                        </f:ajax>
                                    </f:facet>

                                <div jsfc="a4j:outputPanel" id="pTableCheckPanel">
                                    <h:selectBooleanCheckbox id="targetCheckBox" value="#{item.checkBox}" onchange="document.getElementById('#{rich:clientId('btnCheckbox')}').click();" />
                                    <a4j:commandButton
                                        id="btnCheckbox"
                                        render="smsCollectSettingMeterMeterManagementBean:pulseEditForm:p4Panel
                                                smsCollectSettingMeterMeterManagementBean:pulseSettingEditForm:p5Panel
                                                smsCollectSettingMeterMeterManagementBean:pulseCurrentValueForm:p6MeterMngIdListPanel
                                                smsCollectSettingMeterMeterManagementBean:pulseMeterStatusForm:p7Panel
                                                smsCollectSettingMeterMeterManagementBean:pulseNowValBtnForm"
                                        style="display:none;"
                                        actionListener="#{smsCollectSettingMeterMeterManagementBean.checkBoxOperation()}"
                                        onbegin=""
                                        oncomplete="pulseCheckboxClick()"
                                    />
                                </div>
                                </rich:column>
                                <rich:column headerClass="table_header" width="55px">
                                    <f:facet name="header">
                                        管理番号
                                    </f:facet>
                                    <h:outputText id="meterMngId" value="#{item.meterMngId}" />
                                </rich:column>
                                <rich:column headerClass="table_header" width="65px">
                                    <f:facet name="header">
                                        ユーザー<br />コード
                                    </f:facet> <h:outputText id="tenantId"
                                        value="#{item.tenantId}" rendered="#{item.tenantId != null}" /> <h:outputText
                                        id="tenantIdBlank" value="-" rendered="#{item.tenantId == null}" />
                                </rich:column>
                                <rich:column headerClass="table_header" width="150px">
                                    <f:facet name="header">
                                        テナント番号<br/>
                                        テナント名
                                    </f:facet> <ui:fragment
                                        rendered="#{item.tenantId != null}">
                                        <h:outputText id="buildingNo" value="#{item.buildingNo}" />
                                        <br />
                                        <h:outputText id="buildingName" value="#{item.buildingName}" />
                                    </ui:fragment> <h:outputText id="buildingNoBlank" value="-"
                                        rendered="#{item.tenantId == null}" />
                                </rich:column>
                                <rich:column headerClass="table_header" width="95px">
                                    <f:facet name="header">
                                        計器ID
                                    </f:facet>
                                    <h:outputText id="meterId" value="#{item.meterId}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="85px">
                                    <f:facet name="header">
                                        種別
                                    </f:facet>
                                    <h:outputText id="meterTypeName" value="#{item.meterTypeName}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="70px">
                                    <f:facet name="header">
                                        パルス種別
                                    </f:facet>
                                    <h:outputText id="pulseType" value="#{item.pulseTypeName}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="70px">
                                    <f:facet name="header">
                                        パルス重み
                                    </f:facet>
                                    <h:outputText id="pulseWeight" value="#{item.pulseWeightCal}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="70px">
                                    <f:facet name="header">
                                        乗率
                                    </f:facet>
                                    <h:outputText id="multi" value="#{item.multi}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="125px">
                                    <f:facet name="header">
                                        コンセント<br />レーター名
                                    </f:facet>
                                    <h:outputText id="concentratorName" value="#{item.concentratorName}"/>
                                </rich:column>
                                <rich:column headerClass="table_header" width="100px">
                                    <f:facet name="header">
                                        操作状態
                                    </f:facet> <ui:fragment
                                        rendered="${item.srvEnt == '9'}">
                                    <h:outputText id="operationStatusError" style="color: #ff0000;"
                                        value="#{item.operationStatus}" />
                                    </ui:fragment> <ui:fragment rendered="${item.srvEnt == '1'}">
                                    <h:outputText id="operationStatusRequesting"
                                        style="color: #0000D0;" value="#{item.operationStatus}" />
                                    </ui:fragment> <ui:fragment
                                        rendered="${item.srvEnt != '9' and item.srvEnt != '1'}">
                                    <h:outputText id="operationStatus"
                                        value="#{item.operationStatus}" />
                                    </ui:fragment>
                                </rich:column>
                                <rich:column headerClass="table_header" width="125px">
                                    <f:facet name="header">
                                        コメント
                                    </f:facet>
                                    <h:outputText id="memo" value="#{item.memo}" />
                                </rich:column>
                                <rich:column headerClass="table_header" width="80px">
                                    <f:facet name="header">
                                        検満
                                    </f:facet>
                                    <ui:fragment rendered="${item.dispYearFlg == '0'}" >
                                        <h:outputText id="examEndYm" value="#{item.examEndYm}"/>
                                    </ui:fragment>
                                    <ui:fragment rendered="${item.dispYearFlg == '1'}" >
                                        <h:outputText id="examEndYmWareki" value="#{item.examEndYmWareki}"/>
                                    </ui:fragment>
                                </rich:column>
                                <c:if test="#{smsCollectSettingMeterMeterManagementBean.osakiAuth}">
                                    <rich:column headerClass="table_header" width="55px" id="pMeterPreSitu"> <f:facet
                                            name="header">
                                        メーター<br />状況
                                        </f:facet> 
                                        <h:outputText id="meterPresentSituation" value="#{item.meterPresentSituationDisp}" />
                                    </rich:column>
                                    <rich:column headerClass="table_header" width="55px" id="pAlertPauseFlg"> <f:facet
                                            name="header">
                                        アラート<br />停止
                                        </f:facet><ui:fragment
                                            rendered="${item.alertPauseFlg == '1'}">
                                            <h:outputText id="alertPause" value="#{item.alertPauseDisp}"
                                                style="color: #ff0000;"/></ui:fragment>
                                    </rich:column>
                                    <rich:column headerClass="table_header" width="160px" id="pAlertPause"> <f:facet
                                            name="header">
                                        アラート停止期間
                                        </f:facet>
                                        <h:outputText id="alertPauseStart" value="#{item.alertPauseStart}" />
                                        <ui:fragment rendered="#{(item.alertPauseStart != null and !item.alertPauseStart.isEmpty()) ||
                                            (item.alertPauseEnd != null and !item.alertPauseEnd.isEmpty())}" >
                                            <h:outputText value="&nbsp;-&nbsp;" />
                                        </ui:fragment>
                                        <h:outputText id="alertPauseEnd" value="#{item.alertPauseEnd}" />
                                    </rich:column>
                                    <rich:column headerClass="table_header" width="180px" id="pMeterStatusMemo"> <f:facet
                                            name="header">
                                        備考
                                        </f:facet> 
                                        <h:outputText id="meterStatusMemo" value="#{item.meterStatusMemo}" />
                                    </rich:column>
                                </c:if>
                                <rich:column headerClass="table_header" width="13.5px" class="scroll_space"/>
                            </rich:extendedDataTable>
                        </form>
                    </div>
                </div>
            </c:if>
        </div>
    </div>
</div>

<!-- 現在表示が残る件の対応 -->
<h:form id="pulseNowValBtnForm">
    <a4j:commandButton id="nowValResetBtn" class="nowValResetBtn"
        style="display: none;" value="現在値表示リセット" execute="@form"
        render="smsCollectSettingMeterMeterManagementBean:s6CurrentValueDispPanel
                smsCollectSettingMeterMeterManagementBean:p6CurrentValueDispPanel"
        actionListener="#{smsCollectSettingMeterMeterManagementBean.resetNowVal()}">
    </a4j:commandButton>
</h:form>
</html>
