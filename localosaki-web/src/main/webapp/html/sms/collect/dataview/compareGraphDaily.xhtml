<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:cust="http://xmlns.jcp.org/jsf/component"
      xmlns:oslib="http://osaki.co.jp/base-component"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
    <head jsfc="h:head">
        <title>データ比較グラフ（日報）</title>
    </head>
    <body jsfc="h:body">
        <ui:composition template="/html/template/template_collect_sidemenu.xhtml">
            <ui:define name="content_side">
                <h:outputStylesheet library="css" name="common/rfCalendar.css" />
                <h:outputStylesheet library="css" name="sms/collect/dataview/compareGraph.css" />
                <h:outputScript library="js" name="common/Chart.min.js" />
                <h:outputScript library="js" name="sms/collect/dataview/compareGraph.js"/>

                <form jsfc="h:form" id="smsDailyBean">
                    <div class="inner_content">
                        <div jsfc="a4j:outputPanel" id="dailyDataPanel">
                            <div class="title_area_warp">
                                <!-- 画面タイトル -->
                                <div class="title_area_left">
                                    <h2 class="page_title">データ比較グラフ（日報）</h2>
                                    <!-- ヘルプボタン -->
                                    <c:if test="#{indexBean.userGuideBool}">
                                        <h:commandLink class="help_icon"
                                            action="#{indexBean.userGuide()}" target="_blank" />
                                    </c:if>
                                    <p class="page_subtitle">
                                        <h:outputText value="各メーターの30分計量値または1時間計量値の&lt;br /&gt;
                                        データ比較グラフ(使用量)を表示します。" escape="false" />
                                    </p>
                                </div>
                                <div class="clear" />

                            <div class="contents_title contents_accordion_header contents_daily">
                                <h:graphicImage class="button_icon button_opener" library="images" name="demand/demand_container_opner.png" style="display: none" />
                                <h:graphicImage class="button_icon button_closer" library="images" name="demand/demand_container_closer.png" />
                                <span class="contents_title_body">表示条件</span>
                            </div>
                            <div class="contents_form_area contents_accordion_body">
                                <div class="msg">表示内容を変更したい場合は、下記を変更し、[表示]ボタンを押してください。</div>
                                <div class="conditions">
                                    <div>
                                        <label class="TXT008 L1">接続先</label>
                                        <f:ajax event="change" render="meterMngId dispDirect dispTimeUnit startTime" listener="#{smsCollectDataviewCompareGraphDailyBean.changeDevIdPulldown()}">
                                            <select jsfc="h:selectOneMenu" value="#{smsCollectDataviewCompareGraphDailyBean.devId}" class="SEL1">
                                                <option jsfc="f:selectItems" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.devIdMap}" />
                                            </select>
                                        </f:ajax>
                                    </div>
                                    <div>
                                        <label class="TXT008 L2">メーター表示切替</label>
                                        <f:ajax event="click" listener="#{smsCollectDataviewCompareGraphDailyBean.changePageNoPulldown()}">
                                            <select jsfc="h:selectOneMenu" id="meterMngId" value="#{smsCollectDataviewCompareGraphDailyBean.meterMngId}" class="SEL2">
                                                <option jsfc="f:selectItems" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.meterMngIdMap}" />
                                            </select>
                                        </f:ajax>
                                    </div>
                                </div>

                                <div class="conditions">
                                    <div>
                                        <label class="TXT008 L3">メータータイプ</label>
                                        <c:set var="selectedMeterKind" value="#{smsCollectDataviewCompareGraphDailyBean.meterKind}" />
                                        <f:ajax event="change" render="smsDailyBean:meterMngId" listener="#{smsCollectDataviewCompareGraphDailyBean.changeMeterKindRadio()}">
                                            <ui:repeat value="#{smsCollectDataviewCompareGraphDailyBean.meterKindMap}" var="meterKindEntry">
                                                <input type="radio" jsf:id="meterKindArea" a:name="#{hiddenMeterKind.clientId}" value="#{meterKindEntry.value}"
                                                       a:checked="#{meterKindEntry.value eq selectedMeterKind ? 'checked' : null}"
                                                       style="width: 16px;" />
                                                <h:outputLabel for="meterKindArea" value="#{meterKindEntry.key}"
                                                               style="width: 120px; text-align: left; position: relative; right: 10px;" />
                                            </ui:repeat>
                                        </f:ajax>

                                        <h:inputHidden binding="#{hiddenMeterKind}" value="#{selectedMeterKind}" />
                                    </div>
                                </div>

                                <div class="conditions">
                                    <div>
                                        <label class="TXT008 L4">表示方向</label>
                                        <f:ajax event="click" listener="#{smsCollectDataviewCompareGraphDailyBean.changeDispDirectPulldown()}">
                                            <select jsfc="h:selectOneMenu" id="dispDirect" value="#{smsCollectDataviewCompareGraphDailyBean.dispDirect}" class="SEL3">
                                                <option jsfc="f:selectItems" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.dispDirectMap}" />
                                            </select>
                                        </f:ajax>
                                    </div>
                                    <div>
                                        <label class="TXT008 L5">表示種別</label>
                                        <span class="TXT008 disp">使用量</span>
                                    </div>
                                    <div>
                                        <label class="TXT008 L6">開始時刻</label>
                                        <f:ajax event="click" listener="#{smsCollectDataviewCompareGraphDailyBean.changeStartTimePulldown()}">
                                            <select jsfc="h:selectOneMenu" id="startTime" value="#{smsCollectDataviewCompareGraphDailyBean.startTime}" class="SEL3">
                                                <option jsfc="f:selectItems" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.startDateTimeList}" />
                                            </select>
                                        </f:ajax>
                                    </div>
                                    <div>
                                        <label class="TXT008 L7">表示時間単位</label>
                                        <f:ajax event="change" render="startTime" listener="#{smsCollectDataviewCompareGraphDailyBean.changeDispTimeUnitPulldown()}">
                                            <select jsfc="h:selectOneMenu" id="dispTimeUnit" value="#{smsCollectDataviewCompareGraphDailyBean.dispTimeUnit}" class="SEL3">
                                                <option jsfc="f:selectItems" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.dispTimeUnitMap}" />
                                            </select>
                                        </f:ajax>
                                    </div>
                                </div>

                                <div class="conditions">
                                    <div>
                                        <label class="TXT008 L7">テナント名</label>
                                        <span class="TXT008" style="width: 10px;">に&nbsp;&nbsp;</span>
                                        <f:ajax event="blur" render="meterMngId" listener="#{smsCollectDataviewCompareGraphDailyBean.inputTenantName()}">
                                            <input type="text" jsfc="h:inputText" id="tenantName"
                                                   value="#{smsCollectDataviewCompareGraphDailyBean.tenantName}"
                                                   style="width: 400px;" />
                                        </f:ajax>
                                        <label class="TXT008" style="width: 50px; text-align: left;">を含む</label>
                                    </div>
                                </div>

                                <div class="gradation_type_1 button_large_2 button_disp">
                                    <button jsfc="a4j:commandButton"
                                        id="reloadButton"
                                        class="button_width edit_search_start"
                                        value="表示"
                                        action="#{smsCollectDataviewCompareGraphDailyBean.reload()}"
                                        execute="@form" render="#{rich:clientId('dailyDataPanel')}"
                                        onbegin="showBlockModal()" oncomplete="hideBlockModal(true);" />
                                    <h:graphicImage class="button_icon" library="images" name="common/com015.png" />
                                </div>
                            </div>

                            <h:panelGroup id="dateListArea1">
                                <table class="calendar_table1">
                                    <tr>
                                        <td class="col_button_move">
                                            <div class="calendar_table_back gradation_type_1 gradation_type_5">
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_back.png" />
                                            <f:ajax event="click" render="dateListArea1"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveLastMonthCompare1()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarMonthBack1" class="calendar_move_button"
                                                        value="前月" execute="@form" />
                                            </f:ajax>
                                            </div>
                                        </td>
                                        <th colspan="31" class="cal_header">
                                            <div class="calendar_table_ym">
                                                #{smsCollectDataviewCompareGraphDailyBean.titleCompare}1　#{smsCollectDataviewCompareGraphDailyBean.compareBean1.dispYear}年#{smsCollectDataviewCompareGraphDailyBean.compareBean1.startMonth}月

                                                <rich:calendar id="calDayDaily1" class="calDayDaily" datePattern="yyyy/MM/dd"
                                                               enableManualInput="false" showWeeksBar="false" showFooter="false"
                                                               required="false" showInput="false"
                                                               value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.calendarBean.selectedDate}"
                                                               buttonIcon="#{request.contextPath}/resources/images/common/com030.png"
                                                               dayDisableFunction="isSelectableDate"
                                                               dayClassFunction="setCalendarDisableStyle"
                                                               zindex="50"
                                                               styleClass="calobj">
                                                    <f:ajax event="change" render="dateListArea1"
                                                            listener="#{smsCollectDataviewCompareGraphDailyBean.clickCalendarCompare1()}" />
                                                </rich:calendar>
                                            </div>
                                        </th>
                                        <td class="col_button_move">
                                            <div class="calendar_table_next gradation_type_1 gradation_type_5">
                                            <f:ajax event="click" render="dateListArea1"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveNextMonthCompare1()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarMonthNext1" class="calendar_move_button"
                                                        value="翌月" execute="@form"
                                                        disabled="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.nextMonthButtonDisabled}" />
                                            </f:ajax>
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_next.png" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="col_button_move">
                                            <div class="calendar_table_back gradation_type_1 gradation_type_5">
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_back.png" />
                                            <f:ajax event="click" render="dateListArea1"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveLastDayCompare1()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarDayBack1" class="calendar_move_button"
                                                        value="前日" execute="@form" />
                                            </f:ajax>
                                            </div>
                                        </td>

                                        <c:set var="dateList" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.calendarBean.dateList}" />
                                        <ui:repeat var="calendarData"
                                                   value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.calendarBean.dateList}"
                                                   varStatus="status" >
                                            <td id="calendarColumn1_#{status.index}" class="td_calendar_day">
                                                <ui:fragment rendered="#{calendarData.selected}">
                                                    <script type="text/javascript">$("#calendarColumn1_#{status.index}").addClass("td_targetday");</script>
                                                </ui:fragment>

                                                <ui:fragment rendered="#{!empty calendarData.dayKind}">
                                                    <a jsfc="a4j:commandLink" value="#{calendarData.day}" class="#{calendarData.dayKind}" >
                                                        <f:ajax render=":smsDailyBean:dateListArea1"
                                                                listener="#{smsCollectDataviewCompareGraphDailyBean.selectCalDayCompare1(calendarData.day)}" />
                                                    </a>
                                                </ui:fragment>
                                            </td>
                                        </ui:repeat>

                                        <td class="col_button_move">
                                            <div class="calendar_table_next gradation_type_1 gradation_type_5">
                                            <f:ajax event="click" render="dateListArea1"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveNextDayCompare1()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarDayNext1" class="calendar_move_button"
                                                        value="翌日" execute="@form"
                                                        disabled="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.nextDayButtonDisabled}" />
                                            </f:ajax>
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_next.png" />
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </h:panelGroup>
                            <h:panelGroup id="dateListArea2">
                                <table class="calendar_table2">
                                    <tr>
                                        <td class="col_button_move">
                                            <div class="calendar_table_back gradation_type_1 gradation_type_5">
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_back.png" />
                                            <f:ajax event="click" render="dateListArea2"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveLastMonthCompare2()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarMonthBack2" class="calendar_move_button"
                                                        value="前月" execute="@form" />
                                            </f:ajax>
                                            </div>
                                        </td>
                                        <th colspan="31" class="cal_header">
                                            <div class="calendar_table_ym">
                                                #{smsCollectDataviewCompareGraphDailyBean.titleCompare}2　#{smsCollectDataviewCompareGraphDailyBean.compareBean2.dispYear}年#{smsCollectDataviewCompareGraphDailyBean.compareBean2.startMonth}月

                                                <rich:calendar id="calDayDaily2" class="calDayDaily" datePattern="yyyy/MM/dd"
                                                               enableManualInput="false" showWeeksBar="false" showFooter="false"
                                                               required="false" showInput="false"
                                                               value="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.calendarBean.selectedDate}"
                                                               buttonIcon="#{request.contextPath}/resources/images/common/com030.png"
                                                               dayDisableFunction="isSelectableDate"
                                                               dayClassFunction="setCalendarDisableStyle"
                                                               zindex="50"
                                                               styleClass="calobj">
                                                    <f:ajax event="change" render="dateListArea2"
                                                            listener="#{smsCollectDataviewCompareGraphDailyBean.clickCalendarCompare2()}" />
                                                </rich:calendar>
                                            </div>
                                        </th>
                                        <td class="col_button_move">
                                            <div class="calendar_table_next gradation_type_1 gradation_type_5">
                                            <f:ajax event="click" render="dateListArea2"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveNextMonthCompare2()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarMonthNext2" class="calendar_move_button"
                                                        value="翌月" execute="@form"
                                                        disabled="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.nextMonthButtonDisabled}" />
                                            </f:ajax>
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_next.png" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="col_button_move">
                                            <div class="calendar_table_back gradation_type_1 gradation_type_5">
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_back.png" />
                                            <f:ajax event="click" render="dateListArea2"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveLastDayCompare2()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarDayBack2" class="calendar_move_button"
                                                        value="前日" execute="@form" />
                                            </f:ajax>
                                            </div>
                                        </td>

                                        <c:set var="dateList" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.calendarBean.dateList}" />
                                        <ui:repeat var="calendarData"
                                                   value="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.calendarBean.dateList}"
                                                   varStatus="status" >
                                            <td id="calendarColumn2_#{status.index}" class="td_calendar_day">
                                                <ui:fragment rendered="#{calendarData.selected}">
                                                    <script type="text/javascript">$("#calendarColumn2_#{status.index}").addClass("td_targetday");</script>
                                                </ui:fragment>

                                                <ui:fragment rendered="#{!empty calendarData.dayKind}">
                                                    <a jsfc="a4j:commandLink" value="#{calendarData.day}" class="#{calendarData.dayKind}" >
                                                        <f:ajax render=":smsDailyBean:dateListArea2"
                                                                listener="#{smsCollectDataviewCompareGraphDailyBean.selectCalDayCompare2(calendarData.day)}" />
                                                    </a>
                                                </ui:fragment>
                                            </td>
                                        </ui:repeat>

                                        <td class="col_button_move">
                                            <div class="calendar_table_next gradation_type_1 gradation_type_5">
                                            <f:ajax event="click" render="dateListArea2"
                                                    listener="#{smsCollectDataviewCompareGraphDailyBean.moveNextDayCompare2()}">
                                                <button jsfc="a4j:commandButton" id="btnCalendarDayNext2" class="calendar_move_button"
                                                        value="翌日" execute="@form"
                                                        disabled="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.nextDayButtonDisabled}" />
                                            </f:ajax>
                                                <h:graphicImage class="calendar_move_img" library="images" name="demand/demand_calendar_next.png" />
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </h:panelGroup>

                            <c:set var="graphHeaderList1" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.loadSurveyDataList}" />
                            <c:set var="graphListMap1" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.graphListMap}" />
                            <c:set var="graphHeaderList2" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.loadSurveyDataList}" />
                            <c:set var="graphListMap2" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean2.graphListMap}" />
                            <c:set var="targetTimes" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.dispDateList}" />

                            <!-- グラフ表示部 -->
                            <c:choose>
                                <c:when test="#{smsCollectDataviewCompareGraphDailyBean.devId == '0'}">
                                    <ui:include src="/html/sms/collect/dataview/compareGraphViewAllDevice.xhtml"/>
                                </c:when>
                                <c:when test="#{smsCollectDataviewCompareGraphDailyBean.devId != '0'}">
                                    <ui:include src="/html/sms/collect/dataview/compareGraphView.xhtml"/>
                                </c:when>
                            </c:choose>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="titleCompare" value="#{smsCollectDataviewCompareGraphDailyBean.titleCompare}" />
                    <input type="hidden" id="selectableLimitDate" value="#{smsCollectDataviewCompareGraphDailyBean.compareBean1.selectableLimitDate}" />
                </form>
            </ui:define>
        </ui:composition>
    </body>
</html>